"use strict";(globalThis.webpackChunkhumanoid_robotics=globalThis.webpackChunkhumanoid_robotics||[]).push([[855],{8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var s=r(6540);const i={},t=s.createContext(i);function o(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:n},e.children)}},9666:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"modules/ros2/chapter2","title":"Chapter 2: Controlling Humanoids with rclpy","description":"Writing ROS 2 Nodes in Python with rclpy","source":"@site/docs/modules/01-ros2/02-chapter2.md","sourceDirName":"modules/01-ros2","slug":"/modules/ros2/chapter2","permalink":"/Hakathon_01/docs/modules/ros2/chapter2","draft":false,"unlisted":false,"editUrl":"https://github.com/spect-kit-plus/Hakathon_01/tree/main/Humanoid_Robotics/docs/modules/01-ros2/02-chapter2.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 1: Understanding ROS 2 as the Robotic Nervous System","permalink":"/Hakathon_01/docs/modules/ros2/chapter1"},"next":{"title":"Chapter 3: Building the Robot Body in URDF","permalink":"/Hakathon_01/docs/modules/ros2/chapter3"}}');var i=r(4848),t=r(8453);const o={},l="Chapter 2: Controlling Humanoids with rclpy",a={},d=[{value:"Writing ROS 2 Nodes in Python with <code>rclpy</code>",id:"writing-ros-2-nodes-in-python-with-rclpy",level:2},{value:"Basic <code>rclpy</code> Node Structure",id:"basic-rclpy-node-structure",level:3},{value:"Connecting Python AI Agents to ROS Controllers",id:"connecting-python-ai-agents-to-ros-controllers",level:2},{value:"Using Publishers, Subscribers, Timers, and Services in <code>rclpy</code>",id:"using-publishers-subscribers-timers-and-services-in-rclpy",level:2},{value:"Python Publisher Example (<code>motor_command_publisher.py</code>)",id:"python-publisher-example-motor_command_publisherpy",level:3},{value:"Python Subscriber Example (<code>joint_state_subscriber.py</code>)",id:"python-subscriber-example-joint_state_subscriberpy",level:3},{value:"Python Timer Example (<code>status_reporter.py</code>)",id:"python-timer-example-status_reporterpy",level:3},{value:"Python Service Server/Client Example (<code>add_two_ints_server.py</code>, <code>add_two_ints_client.py</code>)",id:"python-service-serverclient-example-add_two_ints_serverpy-add_two_ints_clientpy",level:3},{value:"Hands-on Example: Sending Mock Motor Commands",id:"hands-on-example-sending-mock-motor-commands",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsxs)(n.h1,{id:"chapter-2-controlling-humanoids-with-rclpy",children:["Chapter 2: Controlling Humanoids with ",(0,i.jsx)(n.code,{children:"rclpy"})]})}),"\n",(0,i.jsxs)(n.h2,{id:"writing-ros-2-nodes-in-python-with-rclpy",children:["Writing ROS 2 Nodes in Python with ",(0,i.jsx)(n.code,{children:"rclpy"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"rclpy"})})," is the Python client library for ROS 2. It provides a convenient and Pythonic way to write ROS 2 applications, including nodes, publishers, subscribers, services, and actions. If you're familiar with Python, ",(0,i.jsx)(n.code,{children:"rclpy"})," allows you to quickly develop and test robotic functionalities."]}),"\n",(0,i.jsxs)(n.p,{children:["Before you start, make sure you have ROS 2 installed (Module 1) and your Python environment is set up with ",(0,i.jsx)(n.code,{children:"rclpy"}),"."]}),"\n",(0,i.jsxs)(n.h3,{id:"basic-rclpy-node-structure",children:["Basic ",(0,i.jsx)(n.code,{children:"rclpy"})," Node Structure"]}),"\n",(0,i.jsxs)(n.p,{children:["Every ",(0,i.jsx)(n.code,{children:"rclpy"})," node inherits from ",(0,i.jsx)(n.code,{children:"rclpy.node.Node"}),". Here's the most basic structure:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass MyCustomNode(Node):\r\n    def __init__(self):\r\n        super().__init__('my_custom_node') # Initialize the node with a unique name\r\n        self.get_logger().info('My Custom Node has been started!')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args) # Initialize rclpy\r\n    node = MyCustomNode() # Create the node\r\n    try:\r\n        rclpy.spin(node) # Keep the node alive and processing callbacks\r\n    except KeyboardInterrupt:\r\n        node.get_logger().info('Node stopped cleanly')\r\n    finally:\r\n        node.destroy_node() # Destroy the node\r\n        rclpy.shutdown() # Shut down rclpy\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"rclpy.init(args=args)"}),": Initializes the ROS 2 client library. Must be called before any ROS 2 activity."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"super().__init__('my_custom_node')"}),": Calls the base ",(0,i.jsx)(n.code,{children:"Node"})," class constructor, giving the node a name."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"rclpy.spin(node)"}),": Blocks until the node is shut down, allowing callbacks (e.g., from subscribers, timers) to be processed."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"node.destroy_node()"})," and ",(0,i.jsx)(n.code,{children:"rclpy.shutdown()"}),": Cleanly shuts down the node and the client library."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"connecting-python-ai-agents-to-ros-controllers",children:"Connecting Python AI Agents to ROS Controllers"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"rclpy"})," enables AI agents written in Python to seamlessly connect with ROS 2-based robot controllers. An AI agent might be a reinforcement learning policy, a classical planning algorithm, or an LLM-based cognitive planner (as we'll see in Module 4). By using ",(0,i.jsx)(n.code,{children:"rclpy"}),", these agents can:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Receive Sensor Data"}),": Subscribe to topics publishing camera images, LiDAR scans, joint states, etc."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Send Commands"}),": Publish velocity commands, joint position targets, or trigger ROS 2 actions/services to robot controllers."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Integrate with Perception/Planning"}),": Utilize outputs from other ROS 2 nodes (e.g., object detections, navigation paths)."]}),"\n"]}),"\n",(0,i.jsxs)(n.h2,{id:"using-publishers-subscribers-timers-and-services-in-rclpy",children:["Using Publishers, Subscribers, Timers, and Services in ",(0,i.jsx)(n.code,{children:"rclpy"})]}),"\n",(0,i.jsxs)(n.h3,{id:"python-publisher-example-motor_command_publisherpy",children:["Python Publisher Example (",(0,i.jsx)(n.code,{children:"motor_command_publisher.py"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"This node will simulate an AI agent publishing motor commands."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom geometry_msgs.msg import Twist # Common message for velocity commands\r\n\r\nclass MotorCommandPublisher(Node):\r\n    def __init__(self):\r\n        super().__init__('motor_command_publisher')\r\n        self.publisher_ = self.create_publisher(Twist, 'cmd_vel', 10)\r\n        self.timer_period = 0.1 # publish every 100ms\r\n        self.timer = self.create_timer(self.timer_period, self.timer_callback)\r\n        self.linear_x = 0.0\r\n        self.angular_z = 0.0\r\n        self.get_logger().info('Motor Command Publisher started.')\r\n\r\n    def timer_callback(self):\r\n        msg = Twist()\r\n        self.linear_x = 0.1 # Move forward at 0.1 m/s\r\n        self.angular_z = 0.0 # No rotation\r\n        msg.linear.x = self.linear_x\r\n        msg.angular.z = self.angular_z\r\n        self.publisher_.publish(msg)\r\n        self.get_logger().info(f'Publishing velocity: linear_x={self.linear_x:.2f}, angular_z={self.angular_z:.2f}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = MotorCommandPublisher()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"python-subscriber-example-joint_state_subscriberpy",children:["Python Subscriber Example (",(0,i.jsx)(n.code,{children:"joint_state_subscriber.py"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"This node will subscribe to simulated joint states from a robot."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom sensor_msgs.msg import JointState # Common message for joint states\r\n\r\nclass JointStateSubscriber(Node):\r\n    def __init__(self):\r\n        super().__init__('joint_state_subscriber')\r\n        self.subscription = self.create_subscription(\r\n            JointState,\r\n            'joint_states', # Assuming 'joint_states' topic\r\n            self.listener_callback,\r\n            10)\r\n        self.subscription # prevent unused variable warning\r\n        self.get_logger().info('Joint State Subscriber started.')\r\n\r\n    def listener_callback(self, msg):\r\n        # self.get_logger().info(f'Received Joint States: {msg.name}, {msg.position}')\r\n        for i in range(len(msg.name)):\r\n            self.get_logger().info(f'  Joint: {msg.name[i]}, Position: {msg.position[i]:.2f}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = JointStateSubscriber()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"python-timer-example-status_reporterpy",children:["Python Timer Example (",(0,i.jsx)(n.code,{children:"status_reporter.py"}),")"]}),"\n",(0,i.jsx)(n.p,{children:"Timers allow a node to execute a callback function periodically."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import String\r\n\r\nclass StatusReporter(Node):\r\n    def __init__(self):\r\n        super().__init__('status_reporter')\r\n        self.publisher_ = self.create_publisher(String, 'robot_status', 10)\r\n        self.timer_period = 2.0 # seconds\r\n        self.timer = self.create_timer(self.timer_period, self.timer_callback)\r\n        self.get_logger().info('Status Reporter started.')\r\n\r\n    def timer_callback(self):\r\n        msg = String()\r\n        msg.data = 'Robot is operational and standing by.'\r\n        self.publisher_.publish(msg)\r\n        self.get_logger().info(f'Publishing status: \"{msg.data}\"')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = StatusReporter()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"python-service-serverclient-example-add_two_ints_serverpy-add_two_ints_clientpy",children:["Python Service Server/Client Example (",(0,i.jsx)(n.code,{children:"add_two_ints_server.py"}),", ",(0,i.jsx)(n.code,{children:"add_two_ints_client.py"}),")"]}),"\n",(0,i.jsxs)(n.p,{children:["ROS 2 services require a ",(0,i.jsx)(n.code,{children:".srv"})," file defining the request and response types. For this example, assume you have a custom package with ",(0,i.jsx)(n.code,{children:"AddTwoInts.srv"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# AddTwoInts.srv\r\nint64 a\r\nint64 b\r\n---\r\nint64 sum\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Service Server:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts # Assuming this SRV is available\r\n\r\nclass AddTwoIntsService(Node):\r\n    def __init__(self):\r\n        super().__init__('add_two_ints_service')\r\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\r\n        self.get_logger().info('Add Two Ints Service started.')\r\n\r\n    def add_two_ints_callback(self, request, response):\r\n        response.sum = request.a + request.b\r\n        self.get_logger().info(f'Incoming request: a={request.a}, b={request.b}')\r\n        self.get_logger().info(f'Sending response: sum={response.sum}')\r\n        return response\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = AddTwoIntsService()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Service Client:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts # Assuming this SRV is available\r\nimport sys\r\n\r\nclass AddTwoIntsClient(Node):\r\n    def __init__(self):\r\n        super().__init__('add_two_ints_client')\r\n        self.client = self.create_client(AddTwoInts, 'add_two_ints')\r\n        while not self.client.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('Service not available, waiting again...')\r\n        self.req = AddTwoInts.Request()\r\n        self.get_logger().info('Add Two Ints Client started.')\r\n\r\n    def send_request(self, a, b):\r\n        self.req.a = a\r\n        self.req.b = b\r\n        self.future = self.client.call_async(self.req)\r\n        rclpy.spin_until_future_complete(self, self.future)\r\n        return self.future.result()\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    if len(sys.argv) != 3:\r\n        node = Node('add_two_ints_client_error')\r\n        node.get_logger().error('Usage: ros2 run <package_name> add_two_ints_client A B')\r\n        rclpy.shutdown()\r\n        return\r\n\r\n    node = AddTwoIntsClient()\r\n    a = int(sys.argv[1])\r\n    b = int(sys.argv[2])\r\n    response = node.send_request(a, b)\r\n    if response:\r\n        node.get_logger().info(f'Result of add_two_ints: {a} + {b} = {response.sum}')\r\n    else:\r\n        node.get_logger().error('Service call failed.')\r\n    \r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(n.p,{children:"To run the service examples:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Ensure you have a custom ROS 2 package where ",(0,i.jsx)(n.code,{children:"AddTwoInts.srv"})," is defined and built."]}),"\n",(0,i.jsxs)(n.li,{children:["Launch the server: ",(0,i.jsx)(n.code,{children:"ros2 run <package_name> add_two_ints_server"})]}),"\n",(0,i.jsxs)(n.li,{children:["Launch the client: ",(0,i.jsx)(n.code,{children:"ros2 run <package_name> add_two_ints_client 5 7"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"hands-on-example-sending-mock-motor-commands",children:"Hands-on Example: Sending Mock Motor Commands"}),"\n",(0,i.jsxs)(n.p,{children:["Let's create a full example where a Python AI agent (simulated here) periodically publishes a ",(0,i.jsx)(n.code,{children:"Twist"})," message to the ",(0,i.jsx)(n.code,{children:"cmd_vel"})," topic, simulating a robot moving forward."]}),"\n",(0,i.jsxs)(n.p,{children:["First, ensure you have a robot in simulation (e.g., Gazebo or Isaac Sim) that subscribes to ",(0,i.jsx)(n.code,{children:"/cmd_vel"})," and translates these into actual robot movement."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"simple_ai_agent.py"}),":"]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom geometry_msgs.msg import Twist\r\nimport time\r\n\r\nclass SimpleAIAgent(Node):\r\n    def __init__(self):\r\n        super().__init__('simple_ai_agent')\r\n        self.publisher_ = self.create_publisher(Twist, 'cmd_vel', 10)\r\n        self.timer_period = 0.5 # Publish commands every 0.5 seconds\r\n        self.timer = self.create_timer(self.timer_period, self.timer_callback)\r\n        self.get_logger().info('Simple AI Agent started.')\r\n        self.forward_speed = 0.1 # m/s\r\n        self.turn_speed = 0.0 # rad/s\r\n\r\n    def timer_callback(self):\r\n        msg = Twist()\r\n        msg.linear.x = self.forward_speed\r\n        msg.angular.z = self.turn_speed\r\n        self.publisher_.publish(msg)\r\n        self.get_logger().info(f'Commanding: Linear X={self.forward_speed:.2f}, Angular Z={self.turn_speed:.2f}')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    agent_node = SimpleAIAgent()\r\n    rclpy.spin(agent_node)\r\n    agent_node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(n.p,{children:"To run this:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Launch your simulated robot (e.g., in Gazebo)."}),"\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.code,{children:"python simple_ai_agent.py"}),".\r\nYour robot should start moving forward in the simulation. You can then modify ",(0,i.jsx)(n.code,{children:"forward_speed"})," or ",(0,i.jsx)(n.code,{children:"turn_speed"})," in the code to experiment with different movements."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This hands-on example demonstrates how simple Python ",(0,i.jsx)(n.code,{children:"rclpy"})," nodes can directly control a humanoid robot's movements through ROS 2 topics."]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);